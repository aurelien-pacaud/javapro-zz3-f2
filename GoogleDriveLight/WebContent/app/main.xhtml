<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:cc="http://java.sun.com/jsf/composite">
	
<h:head>
	<h:outputStylesheet library="css" name="style.css" />
	<title>Google Drive Light</title>
</h:head>
<h:body>
	
	<!-- Permet la deconnexion -->
	<h:form>
		<p:commandLink id="ajax" action="#{loginManagedBean.logout}" ajax="false">  
        	<h:outputText value="#{msg['labelDeco']} (#{loginManagedBean.username})" />
    	</p:commandLink>
    </h:form>
	
	<h:form id="search">
		<p:inputText id="searchid" value="#{driveManagedBean.pattern}" required="true"/>
		<p:commandButton value="Search" action="#{driveManagedBean.search}" update=":formTable" />
		<p:watermark for="searchid" value="Search with a keyword" />
	</h:form>
	
	<!-- Barre d'outils (haut) -->
	<h:form id="menuBar">
		<p:menubar>  
			<p:submenu label="#{msg['labelMenuFile']}" >  
			    <p:submenu label="#{msg['labelMenuFileNew']}" >  
			        <p:menuitem value="#{msg['labelMenuFileNewTextFile']}" oncomplete="dlgNewTxtFile.show()" icon="ui-icon-document"/>
			        <p:menuitem value="#{msg['labelMenuFileNewPresentationFile']}" icon="ui-icon-contact"/>
			        <p:menuitem value="#{msg['labelMenuFileNewDrawFile']}" icon="ui-icon-image"/>
			        <p:separator /> 
			        <p:menuitem value="#{msg['labelMenuFileNewDirectory']}" icon="ui-icon-folder-collapsed" oncomplete="dlgNewDir.show()"/>  
			    </p:submenu> 
			    <p:separator />  
			    <p:menuitem value="#{msg['labelMenuFileQuit']}" icon="ui-icon-squaresmall-close" action="#{loginManagedBean.logout}"/>  
			</p:submenu>  
		</p:menubar>
	</h:form>
	<!-- Les éléments suivants sont organisés selon un layout -->
	<p:layout>
		<!-- Arbre des fichiers (gauche) -->
		<p:layoutUnit position="west" size="330" header="#{msg['drive']}" resizable="true">
		    <h:form id="formTree">
			   <p:tree value="#{driveManagedBean.model}" var="node" dynamic="true" cache="true" 
			           id="tree" 
			           selection="#{driveManagedBean.selectedNode}"  			 
                  	   selectionMode="single" >
                  	   
                   <p:ajax event="select" listener="#{driveManagedBean.onNodeSelect}" update=":formTree, :formTable, :formDetails" />	   
			       
		           <p:treeNode rendered="#{node.directory}" styleClass="#{!node.directory ? 'noDisplayTreeNode' : ''}">
		             <h:graphicImage alt="folder" value="/resources/images/folder.png" /> <h:outputText value=" #{node}" />
		       	   </p:treeNode>

			   </p:tree>		
			</h:form>				
	    </p:layoutUnit>
	    
	    <!-- Détails d'un répertoire (centre) -->
		<p:layoutUnit position="center">
				
		    <h:form id="formTable">
		    
		    	<!-- Contextmenu de la table -->
				 <p:contextMenu for="table">  
			        <p:menuitem value="#{msg['labelDelete']}" update=":formTable :formTree" icon="ui-icon-close" action="#{driveManagedBean.deleteFile}"/>  
			    </p:contextMenu> 
		    
		    	<p:breadCrumb model="#{driveManagedBean.breadCrumb}" rendered="#{driveManagedBean.pattern == null}" />
		    			    
		    	<!-- Définition de la table -->			  
			    <p:dataTable id="table" var="file" value="#{driveManagedBean.dirContent}" 
			    			 selection="#{driveManagedBean.selectedFile}"
			                 selectionMode="single" rowKey="#{file.data.path}">		        
			       			       	
			        <p:ajax event="rowSelect" listener="#{driveManagedBean.onRowSelect}" update=":formDetails :formTable :formTree" />			        
			        			        
			        <p:column sortBy="#{file.data.name}">
			            <f:facet name="header">
			            	Name
			            </f:facet>
			            <h:graphicImage value="/resources/images/#{file.data.type.toString().toLowerCase()}.png"/> <h:outputText value=" #{file.data.name}"/>
			        </p:column>
			
			        <p:column sortBy="#{file.data.type}">
			            <f:facet name="header">
			                    Type
			            </f:facet>
			            <h:outputText value="#{file.data.type}" />
			        </p:column>
			
			        <p:column sortBy="#{file.data.size}">
			            <f:facet name="header">
			                    Size
			            </f:facet>
			            <h:outputText value="#{file.data.size}"> <f:convertNumber pattern="#.## Ko" /> </h:outputText>
			        </p:column>
			
			        <p:column>
			            <f:facet name="header">
			                    Last Updated
			            </f:facet>
			            <h:outputText value="#{file.data.lastModified}"><f:convertDateTime dateStyle="short" type="both" /> </h:outputText>
			        </p:column>			        
			    </p:dataTable>
			</h:form>  
					
	    </p:layoutUnit>
	    
	    <!-- Détails d'un fichier (droite) -->
	    <p:layoutUnit position="east" size="330" header="#{msg['details']}" resizable="true">
		    <h:form id="formDetails">
			   <p:dataTable id="table" var="file" value="#{driveManagedBean.selectedFile}" rendered="#{driveManagedBean.selectedFile != null}">
			        <p:column>
			            <f:facet name="header">
			            	File Name
			            </f:facet>
			            <h:outputText value="#{file.data.name}"/>
			        </p:column>
			        
			        <p:column>
			            <f:facet name="header">
			            	Path
			            </f:facet>
			            <h:outputText value="#{file.data.path}"/>
			        </p:column>
			        
			        <p:column>
			            <f:facet name="header">
			            	Size
			            </f:facet>
			            <h:outputText value="#{file.data.size}"/>
			        </p:column>
				</p:dataTable>
				<h:outputText value="#{msg['fileDetails']}" rendered="#{driveManagedBean.selectedFile == null}"></h:outputText>
			</h:form>				
	    </p:layoutUnit>
	    
	</p:layout>
	
	<!-- Dialog permettant la création d'un nouveau fichier texte -->
    <p:dialog header="#{msg['labelTitreName']}" widgetVar="dlgNewTxtFile" draggable="false" resizable="false" modal="true">
	    <h:form>  
	        <h:panelGrid columns="2" style="margin-bottom:10px">  
	            <h:outputLabel for="name" value="#{msg['labelName']}" />  
	            <p:inputText id="name" value="#{driveManagedBean.filename}" />   
	        </h:panelGrid>  
	  
	       <p:commandButton value="#{msg['labelValid']}" action="#{driveManagedBean.createFile}" oncomplete="dlgNewTxtFile.hide();" update=":formTable :formTree"/>     
	              
	    </h:form>
    </p:dialog>
    
    <!-- Dialog permettant la création d'un nouveau répertoire -->
     <p:dialog header="#{msg['labelTitreDialogNewRep']}" widgetVar="dlgNewDir" draggable="false" resizable="false" modal="true">
	    <h:form>  
	        <h:panelGrid columns="2" style="margin-bottom:10px">  
	            <h:outputLabel for="name" value="#{msg['labelNameRep']}" />  
	            <p:inputText id="name" value="#{driveManagedBean.dirname}" />   
	        </h:panelGrid>  
	  
	       <p:commandButton value="#{msg['labelValid']}" action="#{driveManagedBean.createDirectory}" oncomplete="dlgNewDir.hide();" update=":formTable :formTree"/>     
	              
	    </h:form>
    </p:dialog>    

</h:body>
</html>