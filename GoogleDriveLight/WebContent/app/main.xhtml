<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:cc="http://java.sun.com/jsf/composite">

	<h:body>
	
		<ui:composition template="/template/common.xhtml"> 
			<ui:define name="title">Google Drive Light</ui:define>
    		<ui:define name="content">
    		
    			<h:form styleClass="search">  
    				<h:graphicImage styleClass="logo" alt="logo" value="/resources/images/logo_128.png"/> 	    							
    				<div id="searchInput">
						<p:inputText id="searchid" value="#{driveManagedBean.pattern}" required="true"/>
						<p:watermark for="searchid" value="#{msg['searchInput']}" />
						
						<p:commandButton icon="ui-icon-search" value="#{msg['search']}" action="#{driveManagedBean.search}" update=":formTable" />	
					</div> 
					<div class="clear" />
				</h:form>    			
    			
    			<div>
	    			<!-- Barre d'outils (haut) -->
					<h:form id="toolbar">
						<p:toolbar>
							<p:toolbarGroup align="left">
								<p:menuButton value="#{msg['create']}">  		
							        <p:menuitem value="#{msg['labelMenuFileNewTextFile']}" oncomplete="dlgNewTxtFile.show()" icon="ui-icon-document"/>
							        <p:menuitem value="#{msg['labelMenuFileNewPresentationFile']}" icon="ui-icon-contact"/>
							        <p:menuitem value="#{msg['labelMenuFileNewDrawFile']}" icon="ui-icon-image"/>
							        <p:separator /> 
							        <p:menuitem value="#{msg['labelMenuFileNewDirectory']}" icon="ui-icon-folder-collapsed" oncomplete="dlgNewDir.show()"/>
								</p:menuButton>
								<p:commandButton ajax="true" type="button" value="Importer" icon="ui-icon-document" onclick="dlgUpload.show()"/>
							</p:toolbarGroup>
						</p:toolbar>
					</h:form>
					
					<!-- Les éléments suivants sont organisés selon un layout -->
					<p:layout styleClass="driveContent">
						<!-- Arbre des fichiers (gauche) -->
						<p:layoutUnit position="west" size="330" header="#{msg['drive']}" styleClass="noBorder">
						    <h:form id="formTree">
						       <!-- Contextmenu de la table -->
								<p:contextMenu for="tree"> 
							      <p:menuitem value="#{msg['labelDelete']}" update=":formTable :formTree" icon="ui-icon-trash" action="#{driveManagedBean.deleteDirectory}"/>  
							    </p:contextMenu> 
						    
							   <p:tree value="#{driveManagedBean.model}" var="node" dynamic="true" cache="true" 
							           id="tree" 
							           selection="#{driveManagedBean.selectedNode}"  			 
				                  	   selectionMode="single"
				                  	   styleClass="noBorder" >
				                  	   
				                   <p:ajax event="select" listener="#{driveManagedBean.onNodeSelect}" update=":formTable" />	   
							       
						           <p:treeNode rendered="#{node.directory}" styleClass="#{!node.directory ? 'noDisplayTreeNode' : ''}">
						             <h:graphicImage alt="folder" value="/resources/images/folder.png" /> <h:outputText value=" #{node}" />
						       	   </p:treeNode>
				
							   </p:tree>		
							</h:form>				
					    </p:layoutUnit>
					    
					    
					    
					    <!-- Détails d'un répertoire (centre) -->
						<p:layoutUnit position="center" styleClass="noBorder">
								
						    <h:form id="formTable">
						    
						    	<!-- Contextmenu de la table -->
								<p:contextMenu for="table"> 
							      <p:menuitem value="#{msg['labelDelete']}" update=":formTable :formTree" icon="ui-icon-trash" action="#{driveManagedBean.deleteFile}"/>  
							    </p:contextMenu> 
							    
						    
						    	<p:breadCrumb styleClass="toolbar" model="#{driveManagedBean.breadCrumb}" rendered="#{driveManagedBean.pattern == null}" />
						    	<div class="space" />
						    							    		    
						    	<!-- Définition de la table -->			  
							    <p:dataTable id="table" var="file" value="#{driveManagedBean.dirContent}" 
							    			 selection="#{driveManagedBean.selectedFile}"
							                 selectionMode="single" rowKey="#{file.data.path}"
							                 styleClass="noBorder">		        
							       			       	
							        <p:ajax event="rowSelect" listener="#{driveManagedBean.onRowSelect}" update=":formTable :formTree" oncomplete="dlgFileDetails.show()"/>
							        			        
							        <p:column sortBy="#{file.data.name}">
							            <f:facet name="header">
							            	Name
							            </f:facet>
							            <h:graphicImage value="/resources/images/#{file.data.type.toString().toLowerCase()}.png"/> <h:outputText value=" #{file.data.name}"/>
							        </p:column>
							
							        <p:column sortBy="#{file.data.type}">
							            <f:facet name="header">
							                    Type
							            </f:facet>
							            <h:outputText value="#{file.data.type}" />
							        </p:column>
							
							        <p:column sortBy="#{file.data.size}">
							            <f:facet name="header">
							                    Size
							            </f:facet>
							            <h:outputText value="#{file.data.size}"> <f:convertNumber pattern="#.## Ko" /> </h:outputText>
							        </p:column>
							
							        <p:column>
							            <f:facet name="header">
							                    Last Updated
							            </f:facet>
							            <h:outputText value="#{file.data.lastModified}"><f:convertDateTime dateStyle="short" type="both" /> </h:outputText>
							        </p:column>			        
							    </p:dataTable>
							    
							    <p:dialog rendered="#{driveManagedBean.selectedFile != null}" id="fileDetails" header="#{msg['fileDetails']}" widgetVar="dlgFileDetails" draggable="false" resizable="false">

						            <h:outputText value="#{driveManagedBean.selectedFile.data.name}" /> <br />
						            <h:outputText value="#{driveManagedBean.selectedFile.data.path}" /> <br />
				  
							    </p:dialog>
							</h:form>  
									
					    </p:layoutUnit>
					</p:layout>
				</div>
				
				<!-- Dialog permettant la création d'un nouveau fichier texte -->
			    <p:dialog header="#{msg['labelTitreName']}" widgetVar="dlgNewTxtFile" draggable="false" resizable="false" modal="true">
				    <h:form>  
				        <h:panelGrid columns="2" style="margin-bottom:10px">  
				            <h:outputLabel for="name" value="#{msg['labelName']}" />  
				            <p:inputText id="name" value="#{driveManagedBean.filename}" />   
				        </h:panelGrid>  
				  
				       <p:commandButton value="#{msg['labelValid']}" action="#{driveManagedBean.createFile}" oncomplete="dlgNewTxtFile.hide();" update=":formTable :formTree"/>         
				    </h:form>
			    </p:dialog>
			    
			    <!-- Dialog permettant la création d'un nouveau répertoire -->
			     <p:dialog header="#{msg['labelTitreDialogNewRep']}" widgetVar="dlgNewDir" draggable="false" resizable="false" modal="true">
				    <h:form>  
				        <h:panelGrid columns="2" style="margin-bottom:10px">  
				            <h:outputLabel for="name" value="#{msg['labelNameRep']}" />  
				            <p:inputText id="name" value="#{driveManagedBean.dirname}" />   
				        </h:panelGrid>  
				  
				       <p:commandButton value="#{msg['labelValid']}" action="#{driveManagedBean.createDirectory}" oncomplete="dlgNewDir.hide();" update=":formTable :formTree"/>     
				       <p:growl id="messages" showDetail="true" />       
				    </h:form>
			    </p:dialog>  
			    
			    <!-- Dialog permettant l'upload d'un fichier -->
			     <p:dialog header="#{msg['labelTitreDialogNewRep']}" widgetVar="dlgUpload" draggable="false" resizable="false" modal="true">
				    <h:form enctype="multipart/form-data">
			    		<p:fileUpload fileUploadListener="#{driveManagedBean.handleFileUpload}"
			        	          	  mode="advanced" 
			        	              auto="true"
			            	          update="messages, :formTable"
			                          sizeLimit="100000"/>
			                      
						<p:growl id="messages" showDetail="true" />
					</h:form>
			    </p:dialog>  
    		
    		
    		</ui:define>
    	</ui:composition>

</h:body>
</html>